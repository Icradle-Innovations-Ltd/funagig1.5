# FunaGig API Routing for DigitalOcean App Platform
# Simplified .htaccess without DirectoryMatch for cloud deployment

# API Routing - Handle all requests through PHP API
RewriteEngine On

# Handle CORS preflight requests
RewriteCond %{REQUEST_METHOD} OPTIONS
RewriteRule ^(.*)$ php/api.php [L]

# Route all requests to php/api.php
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_URI} !^/php/
RewriteRule ^(.*)$ php/api.php [L,QSA]

# Prevent access to sensitive files
<FilesMatch "\.(env|log|sql|md|json|lock)$">
    Require all denied
</FilesMatch>

# Prevent access to setup files
<FilesMatch "^(setup_|test_|.*\.example)">
    Require all denied
</FilesMatch>

# Prevent access to hidden files  
<FilesMatch "^\.">
    Require all denied
</FilesMatch>

# Security Headers
<IfModule mod_headers.c>
    # Prevent clickjacking
    Header always set X-Frame-Options SAMEORIGIN
    
    # Prevent MIME type sniffing
    Header always set X-Content-Type-Options nosniff
    
    # XSS Protection
    Header always set X-XSS-Protection "1; mode=block"
    
    # Referrer Policy
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
    
    # CORS is now handled dynamically in PHP config.php
    # Header always set Access-Control-Allow-Origin "https://funagig1-5.vercel.app"
    # Header always set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
    # Header always set Access-Control-Allow-Headers "Content-Type, Authorization"
    # Header always set Access-Control-Allow-Credentials "true"
</IfModule>

# Disable server signature
ServerSignature Off

# Disable directory browsing
Options -Indexes

# Compression for better performance
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/plain
    AddOutputFilterByType DEFLATE text/html
    AddOutputFilterByType DEFLATE text/css
    AddOutputFilterByType DEFLATE application/json
    AddOutputFilterByType DEFLATE application/javascript
</IfModule>